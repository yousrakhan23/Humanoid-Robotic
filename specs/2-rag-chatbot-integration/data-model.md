# Data Model: RAG Chatbot Integration

**Date**: 2025-12-11
**Input**: `specs/2-rag-chatbot-integration/spec.md`

This document defines the data models for the RAG Chatbot Integration feature.

---

## Entity: Book Content Chunk

Represents a segment of the book's text, indexed for retrieval.

| Field | Type | Description | Validation |
|---|---|---|---|
| `id` | UUID | Unique identifier for the chunk. | Required, Primary Key |
| `content` | Text | The text content of the chunk. | Required, Not Null |
| `source_chapter` | String | The chapter from which the chunk was extracted. | |
| `source_section` | String | The section within the chapter from which the chunk was extracted. | |
| `embedding` | Vector | The vector embedding of the content. | Required |

---

## Entity: User Query

Represents a question asked by the user.

| Field | Type | Description | Validation |
|---|---|---|---|
| `id` | UUID | Unique identifier for the query. | Required, Primary Key |
| `session_id` | UUID | Identifier for the user's chat session. | Required, Foreign Key to Chat Session |
| `query_text` | String | The text of the user's query. | Required, Not Null |
| `selected_text` | Text | The user-selected text, if any. | Optional |
| `timestamp` | DateTime | The time the query was submitted. | Required |

---

## Entity: Chatbot Response

Represents the answer generated by the chatbot.

| Field | Type | Description | Validation |
|---|---|---|---|
| `id` | UUID | Unique identifier for the response. | Required, Primary Key |
| `query_id` | UUID | The ID of the user query this response answers. | Required, Foreign Key to User Query |
| `response_text` | Text | The text of the chatbot's response. | Required, Not Null |
| `sources` | JSON | A list of source chunks used to generate the response. | |
| `timestamp` | DateTime | The time the response was generated. | Required |
| `user_feedback` | Integer | User feedback on the response (e.g., 1 for helpful, -1 for not helpful). | Optional |

---

## Entity: Chat Session

Represents a single chat session.

| Field | Type | Description | Validation |
|---|---|---|---|
| `id` | UUID | Unique identifier for the session. | Required, Primary Key |
| `user_id` | String | Identifier for the user (if authenticated). | Optional |
| `start_time` | DateTime | The time the session started. | Required |
| `end_time` | DateTime | The time the session ended. | Optional |

---
